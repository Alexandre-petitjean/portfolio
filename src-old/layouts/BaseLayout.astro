---
import "../styles/global.css";
import Navigation from "../components/Navigation.astro";
import Footer from "../components/Footer.astro";
---

<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Alexandre Petitjean - Expert Django & DevOps</title>
          
          <!-- THEME INITIALIZATION - PREVENTS FOUC -->
          <script is:inline>
              (function() {
                  // Apply theme immediately to prevent flash
                  const theme = localStorage.getItem('theme') || 
                               (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
                  
                  if (theme === 'dark') {
                      document.documentElement.classList.add('dark');
                  } else {
                      document.documentElement.classList.remove('dark');
                  }
                  
                  // Save if not already saved
                  if (!localStorage.getItem('theme')) {
                      localStorage.setItem('theme', theme);
                  }
              })();
          </script>
  </head>
  <body class="bg-gradient-to-br from-gray-50 via-white to-primary-50 dark:from-gray-900 dark:via-gray-800 dark:to-primary-900 transition-colors duration-300">
    <Navigation />

    <main class="mx-auto">
        <slot/>
    </main>

    <Footer />
    
    <!-- GLOBAL THEME TOGGLE SCRIPT -->
    <script is:inline>
        window.themeInitialized = false;
        
        function initializeTheme() {
            if (window.themeInitialized) return;
            
            console.log('ðŸŽ¨ Initializing theme system...');
            
            // Global toggle function
            window.toggleTheme = function() {
                console.log('ðŸ”„ Toggle theme clicked');
                const html = document.documentElement;
                const isDark = html.classList.toggle('dark');
                
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                updateAllIcons();
                
                console.log('âœ… Theme switched to:', isDark ? 'dark' : 'light');
            };
            
            // Update all toggle button icons
            function updateAllIcons() {
                const buttons = document.querySelectorAll('[data-theme-toggle]');
                const isDark = document.documentElement.classList.contains('dark');
                
                buttons.forEach(button => {
                    const sunIcon = button.querySelector('[data-icon="sun"]');
                    const moonIcon = button.querySelector('[data-icon="moon"]');
                    
                    if (isDark) {
                        sunIcon?.classList.add('hidden');
                        moonIcon?.classList.remove('hidden');
                    } else {
                        sunIcon?.classList.remove('hidden');
                        moonIcon?.classList.add('hidden');
                    }
                });
                
                console.log('ðŸ”„ Updated', buttons.length, 'toggle button(s)');
            }
            
            // Add click handlers to all toggle buttons
            function attachEventListeners() {
                const buttons = document.querySelectorAll('[data-theme-toggle]');
                
                buttons.forEach((button, index) => {
                    button.addEventListener('click', window.toggleTheme);
                    console.log('ðŸŽ¯ Attached event listener to button', index + 1);
                });
                
                return buttons.length;
            }
            
            // Initialize
            const buttonCount = attachEventListeners();
            updateAllIcons();
            
            window.themeInitialized = true;
            console.log('âœ… Theme system initialized with', buttonCount, 'button(s)');
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeTheme);
        } else {
            initializeTheme();
        }
        
        // Re-initialize on Astro page navigation
        document.addEventListener('astro:page-load', initializeTheme);
    </script>
</body>
</html>
